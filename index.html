<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>産総研 地質図検索ビューア</title>
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@5.0.1/dist/maplibre-gl.css" />
    <link rel="stylesheet" href="libs/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div id="app">
        <!-- モバイル用ヘッダー -->
        <header id="mobileHeader" class="mobile-header">
            <h1>🗺️ 地質図検索ビューア</h1>
        </header>

        <!-- サイドパネル -->
        <div id="sidebar">
            <h1>地質図検索</h1>

            <!-- 検索コントロール -->
            <div class="control-section">
                <button id="searchBtn" class="primary-btn">
                    <span class="btn-icon">🔍</span>
                    表示範囲で検索
                </button>
                <div id="searchStatus" class="status-text"></div>
            </div>

            <!-- 検索結果リスト -->
            <div class="control-section">
                <h2>検索結果 <span id="resultCount">(0件)</span></h2>
                <div id="searchResults" class="result-list">
                    <p class="placeholder-text">検索ボタンを押すと、現在の表示範囲内にある地質図を検索します。</p>
                </div>
            </div>

            <!-- 表示中のレイヤー -->
            <div class="control-section">
                <h2>表示中の地質図 <span id="layerCount">(0枚)</span></h2>
                <div id="activeLayers" class="layer-list">
                    <p class="placeholder-text">地質図が選択されていません。</p>
                </div>
            </div>

            <!-- シームレス地質図コントロール -->
            <div class="control-section">
                <h2>シームレス地質図</h2>
                <label class="checkbox-label">
                    <input type="checkbox" id="seamlessToggle" />
                    20万分の1シームレス地質図を表示
                </label>
                <div id="seamlessControls" style="display: none;">
                    <div class="slider-container" id="seamlessOpacityContainer">
                        <label>透明度: <span id="seamlessOpacityValue">70</span>%</label>
                        <input type="range" id="seamlessOpacity" min="0" max="100" value="70" />
                    </div>
                    <button id="seamlessLegendBtn" class="seamless-legend-btn">
                        📋 凡例を表示
                    </button>
                </div>
            </div>

            <!-- 世界の地質図（Macrostrat）コントロール -->
            <div class="control-section">
                <h2>世界の地質図</h2>
                <label class="checkbox-label">
                    <input type="checkbox" id="macrostratToggle" />
                    Macrostrat地質図を表示
                </label>
                <div id="macrostratControls" style="display: none;">
                    <div class="slider-container">
                        <label>透明度: <span id="macrostratOpacityValue">70</span>%</label>
                        <input type="range" id="macrostratOpacity" min="0" max="100" value="70" />
                    </div>
                    <button id="macrostratLegendBtn" class="seamless-legend-btn">
                        📋 凡例を表示
                    </button>
                    <p class="macrostrat-info">
                        <a href="https://macrostrat.org/" target="_blank">Macrostrat</a> - 世界225以上の地質図を統合
                    </p>
                </div>
            </div>

            <!-- フッター -->
            <div class="footer">
                <p>データ提供: <a href="https://gbank.gsj.jp/geonavi/" target="_blank">産総研 地質図Navi</a></p>
                <p><a href="https://data.gsj.jp/gkan/" target="_blank">地質調査総合センター CKAN</a></p>
            </div>
        </div>

        <!-- 地図コンテナ -->
        <div id="map"></div>

        <!-- モバイル用現在地ボタン -->
        <button id="mobileLocationBtn" class="mobile-location-btn" title="現在地を表示">
            <i class="fas fa-location-crosshairs"></i>
        </button>

        <!-- モバイル用ボトムナビゲーション -->
        <nav id="mobileNav" class="mobile-nav">
            <button class="mobile-nav-item active" data-panel="search">
                <i class="fas fa-search"></i>
                <span>検索結果</span>
            </button>
            <button class="mobile-nav-item" data-panel="layers">
                <i class="fas fa-layer-group"></i>
                <span>表示中</span>
            </button>
            <button class="mobile-nav-item" data-panel="seamless">
                <i class="fas fa-map"></i>
                <span>シームレス</span>
            </button>
        </nav>

        <!-- モバイル用ボトムシート -->
        <div id="mobileBottomSheet" class="mobile-bottom-sheet">
            <!-- 検索ボタン（ボトムシートの上に固定） -->
            <button id="mobileSearchBtn" class="mobile-search-btn">
                <i class="fas fa-search"></i>
                <span>この範囲で検索</span>
            </button>
            <div id="mobileBottomSheetContent" class="bottom-sheet-content">
                <!-- 検索パネル -->
                <div id="mobileSearchPanel" class="mobile-panel active">
                    <h3>検索結果 <span id="mobileResultCount">(0件)</span></h3>
                    <div id="mobileSearchResults" class="mobile-result-list">
                        <p class="placeholder-text">地図を移動して検索ボタンを押してください。</p>
                    </div>
                </div>
                <!-- レイヤーパネル -->
                <div id="mobileLayersPanel" class="mobile-panel">
                    <h3>表示中の地質図 <span id="mobileLayerCount">(0枚)</span></h3>
                    <div id="mobileActiveLayers" class="mobile-layer-list">
                        <p class="placeholder-text">地質図が選択されていません。</p>
                    </div>
                </div>
                <!-- シームレスパネル -->
                <div id="mobileSeamlessPanel" class="mobile-panel">
                    <h3>シームレス地質図（日本）</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="mobileSeamlessToggle" />
                        20万分の1シームレス地質図を表示
                    </label>
                    <div id="mobileSeamlessControls" style="display: none;">
                        <div class="slider-container">
                            <label>透明度: <span id="mobileSeamlessOpacityValue">70</span>%</label>
                            <input type="range" id="mobileSeamlessOpacity" min="0" max="100" value="70" />
                        </div>
                        <button id="mobileSeamlessLegendBtn" class="seamless-legend-btn">
                            📋 凡例を表示
                        </button>
                    </div>

                    <h3 style="margin-top: 16px;">世界の地質図</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="mobileMacrostratToggle" />
                        Macrostrat地質図を表示
                    </label>
                    <div id="mobileMacrostratControls" style="display: none;">
                        <div class="slider-container">
                            <label>透明度: <span id="mobileMacrostratOpacityValue">70</span>%</label>
                            <input type="range" id="mobileMacrostratOpacity" min="0" max="100" value="70" />
                        </div>
                        <button id="mobileMacrostratLegendBtn" class="seamless-legend-btn">
                            📋 凡例を表示
                        </button>
                        <p class="macrostrat-info">
                            <a href="https://macrostrat.org/" target="_blank">Macrostrat</a> - 世界225以上の地質図を統合
                        </p>
                    </div>
                </div>
            </div>
        </div>


        <!-- 右サイドバー開閉ボタン -->
        <button id="legendSidebarToggle" class="legend-sidebar-toggle" title="凡例パネルを開く">
            <i class="fas fa-chevron-left"></i>
        </button>

        <!-- 右サイドバー（凡例） -->
        <div id="legendSidebar" class="legend-sidebar hidden">
            <!-- リサイズハンドル -->
            <div id="legendResizeHandle" class="legend-resize-handle"></div>
            <div class="legend-sidebar-header">
                <h2 id="legendTitle">凡例</h2>
                <button id="closeLegendBtn" class="legend-close-btn" title="閉じる">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <!-- 凡例画像用ズームコントロール -->
            <div id="legendZoomControls" class="legend-zoom-controls hidden">
                <button class="legend-zoom-btn legend-back-btn" id="legendBackBtn" title="戻る">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button class="legend-zoom-btn" id="legendZoomOutBtn" title="縮小">
                    <i class="fas fa-minus"></i>
                </button>
                <span id="legendZoomLevel">100%</span>
                <button class="legend-zoom-btn" id="legendZoomInBtn" title="拡大">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="legend-zoom-btn" id="legendZoomResetBtn" title="等倍">100%</button>
                <button class="legend-zoom-btn" id="legendZoomFitBtn" title="フィット">Fit</button>
                <button class="legend-zoom-btn legend-download-btn" id="legendDownloadBtn" title="ダウンロード">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            <div id="legendContent" class="legend-content">
                <p class="placeholder-text">地質図を選択すると凡例が表示されます。</p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/maplibre-gl@5.0.1/dist/maplibre-gl.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
